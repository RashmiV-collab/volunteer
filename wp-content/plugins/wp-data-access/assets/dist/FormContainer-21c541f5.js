import{r as u,_ as G,l as r,v as H,V as I,W as R,ag as T,ah as D,a5 as Y,j as e,ai as J,aj as _,ak as P,al as Q,am as X}from"./main.js";import{c as Z,d as S,B as K,i as tt,S as E,F as et,j as nt,g as at}from"./MetaData-bdfb949d.js";import{a as it}from"./AdminTheme-ba57f315.js";import{s as ot,u as st,i as rt}from"./Actions-b625cbe1.js";import{C as lt,a as ct}from"./CardContent-eb18906e.js";import{C as dt}from"./CardActions-0560b6a5.js";import{B as v}from"./Button-e7d59fde.js";import"./iconBase-8840166b.js";const ut=u.lazy(()=>G(()=>import("./Row-17a26135.js"),["./Row-17a26135.js","./main.js","./main-a9f78bc8.css","./MetaData-bdfb949d.js","./iconBase-8840166b.js","./ComputedFieldTypeEnum-9a013b11.js"],import.meta.url)),mt=({appId:s,primaryKey:l,formMode:x,showTable:g,showForm:C})=>{var F;r.debug(s,l,x);const f=Z(),j=u.useMemo(()=>H(),[]),[N,b]=u.useState(!1),[L,w]=u.useState(!1),n=I(R.getState(),s),p=n.src.dbs,h=n.src.tbl;r.debug("metaData",n,p,h);const k=S(t=>T(t,s));r.debug("data",k),u.useEffect(()=>{l===null?V():Object.keys(l).length?U():b(!0)},[l]);const U=()=>{ot(p,h,l,n==null?void 0:n.media,function(t){r.debug(t),f(D({appId:s,data:t.data[0],context:t.context})),b(t!==null)})},V=()=>{if(n.columns&&Array.isArray(n.columns)){const t={};for(let a=0;a<n.columns.length;a++)t[n.columns[a].column_name]=null;r.debug(t),f(D({appId:s,data:t})),r.debug("init"),b(!0)}},A=()=>{let t="";for(const a in n.columns)n.columns[a].extra==="auto_increment"&&(t=n.columns[a].column_name);return r.debug(t),t},O=t=>{for(let a=0;a<n.columns.length;a++)if(n.columns[a].column_name===t)return n.columns[a]},$=t=>{let a=!0;const i=A();for(const c in t){const m=O(c);let d=!0;m.column_name!==i&&m.is_nullable==="NO"&&(t[c]===""||t[c]===null||t[c]===void 0)&&(f(P({appId:s,columnName:c,columnError:!0,columnText:"Field must be entered"})),d=!1,a=!1);const q=Q(R.getState(),s,c);r.debug(q),d&&f(P({appId:s,columnName:c,columnError:!1,columnText:""}))}return a},y=t=>{const a=T(R.getState(),s);$(a)&&(l!==null?st(p,h,l,a,function(i){(i==null?void 0:i.code.toLowerCase())==="ok"?i.data==="Row successfully updated"?(w(!0),_(i.data,{variant:"success"}),t&&setTimeout(()=>{g(!0)},1e3)):i.data==="Nothing to update"&&(_(i.data,{variant:"info"}),t&&g(L)):(_("Error saving data, please check console",{variant:"error"}),r.error(i))}):rt(p,h,a,function(i){if((i==null?void 0:i.code.toLowerCase())==="ok")if(i.data==="Row successfully inserted"){if(w(!0),_(i.data,{variant:"success"}),t){g(!0);return}const c=A(),m={};for(let d=0;d<n.primary_key.length;d++)c!==""?m[n.primary_key[d]]=i.context.insert_id:m[n.primary_key[d]]=a[n.primary_key[d]];r.debug(m),C(m,nt.UPDATE)}else r.error("Invalid response"),_("Invalid response",{variant:"error"});else r.error(i)}))},M=()=>{y(!1)},z=()=>{y(!0)},B=()=>{g(L)},o=S(t=>Y());r.debug("formSettings",o);const W={paddingTop:(o.spacing.aroundGridTop??"")+(o.spacing.aroundGridTopUnit??""),paddingBottom:(o.spacing.aroundGridBottom??"")+(o.spacing.aroundGridBottomUnit??""),paddingLeft:(o.spacing.aroundGridLeft??"")+(o.spacing.aroundGridLeftUnit??""),paddingRight:(o.spacing.aroundGridRight??"")+(o.spacing.aroundGridRightUnit??"")};return e.jsx("div",{className:`${s}_wrapper pp-form`,children:N&&k!==null?e.jsxs(lt,{sx:W,children:[e.jsx(ct,{sx:{padding:0,margin:"5px 0 0 0"},children:e.jsx("form",{id:j,className:"pp-form-content",onSubmit:t=>(t.preventDefault(),!1),children:e.jsx(K,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${o.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(o.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:`${o.spacing.betweenCells}px`,marginBottom:0,background:o.showGrid?((F=tt)==null?void 0:F.palette.mode)===J.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":""},children:e.jsx(u.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(ut,{appId:s,dbs:p,tbl:h,metaData:n,data:k,primaryKey:l,formMode:x,formSettings:o})})})})}),e.jsx(dt,{sx:{marginTop:`${o.spacing.betweenCells}px`,padding:0,paddingRight:`${o.spacing.cellRight}px`,justifyContent:"flex-end"},children:x!==et.VIEW?e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"contained",onClick:M,type:"submit",form:j,children:"APPLY"}),e.jsx(v,{variant:"contained",onClick:z,sx:{marginLeft:"16px"},children:"OK"}),e.jsx(v,{variant:"contained",onClick:B,sx:{marginLeft:"16px"},children:"CANCEL"})]}):e.jsx(v,{variant:"contained",onClick:B,children:"BACK"})})]}):e.jsx("div",{style:{padding:"50px"},children:e.jsx(E,{title:"Loading data..."})})})},gt=u.lazy(()=>G(()=>import("./Settings-6b825480.js"),["./Settings-6b825480.js","./main.js","./main-a9f78bc8.css","./MetaData-bdfb949d.js","./iconBase-8840166b.js","./AdminTheme-ba57f315.js","./SettingsTabEnum-1831dc05.js","./TextField-0f586f77.js","./FormControl-5d7bce62.js","./Select-2486f905.js","./FormHelperText-d043b602.js","./createSvgIcon-d0cfe483.js","./Button-e7d59fde.js","./index.esm-ebe5ee0d.js","./isEqual-956f3fe4.js","./Switch-9746da4d.js","./Close-9e29875c.js","./Chip-505aa5a1.js","./FormControlLabel-b874e6c1.js","./RadioGroup-04724101.js","./Radio-4f834152.js","./settings-04aa9e8b.js","./settings-711afc4e.css","./ComputedFieldTypeEnum-9a013b11.js","./EnumTypeEnum-7ffcf33a.js","./InputAdornment-cdfef043.js","./Actions-b625cbe1.js","./CardContent-eb18906e.js"],import.meta.url)),bt=({appId:s,primaryKey:l,formMode:x,showTable:g,showForm:C})=>{const f=S(j=>X(j,s));return e.jsxs(e.Fragment,{children:[e.jsx(mt,{appId:s,primaryKey:l,formMode:x,showTable:g,showForm:C}),f&&e.jsx(u.Suspense,{fallback:e.jsx(E,{title:"Loading form settings..."}),children:e.jsx(at,{theme:it(),children:e.jsx(gt,{appId:s})})})]})};export{bt as FormContainer,bt as default};
