function stripeFormHandler(){if(!jQuery("#payment_method_wpem_stripe").is(":checked")||0!=jQuery("input[name=stripe_card_id]:checked").size()&&"new"!=jQuery("input[name=stripe_card_id]:checked").val()||0!=jQuery("input.stripe_token").size())return!0;var e=jQuery("#wpem_stripe-card-number").val(),r=jQuery("#wpem_stripe-card-cvc").val(),i=jQuery("#wpem_stripe-card-expiry").payment("cardExpiryVal");jQuery("form.checkout, form#order_review, form#add_payment_method").block({message:null,overlayCSS:{background:"#fff url("+woocommerce_params.ajax_loader_url+") no-repeat center",opacity:.6}});var s={number:e,cvc:r,exp_month:parseInt(i.month)||0,exp_year:parseInt(i.year)||0};return 0<jQuery("#billing_first_name").size()?s.name=jQuery("#billing_first_name").val()+" "+jQuery("#billing_last_name").val():wc_stripe_params.billing_first_name&&(s.name=wc_stripe_params.billing_first_name+" "+wc_stripe_params.billing_last_name),0<jQuery("#billing_address_1").size()?(s.address_line1=jQuery("#billing_address_1").val(),s.address_line2=jQuery("#billing_address_2").val(),s.address_state=jQuery("#billing_state").val(),s.address_city=jQuery("#billing_city").val(),s.address_zip=jQuery("#billing_postcode").val(),s.address_country=jQuery("#billing_country").val()):s.address_line1&&(s.address_line1=wc_stripe_params.billing_address_1,s.address_line2=wc_stripe_params.billing_address_2,s.address_state=wc_stripe_params.billing_state,s.address_city=wc_stripe_params.billing_city,s.address_zip=wc_stripe_params.billing_postcode,s.address_country=wc_stripe_params.billing_country),Stripe.createToken(s,stripeResponseHandler),!1}function stripeResponseHandler(e,r){var i,s=jQuery("form.checkout, form#order_review, form#add_payment_method");r.error?(jQuery(".woocommerce_error, .woocommerce-error, .woocommerce-message, .woocommerce_message, .stripe_token").remove(),jQuery("#wpem_stripe-card-number").closest("p").before('<ul class="woocommerce_error woocommerce-error"><li>'+r.error.message+"</li></ul>"),s.unblock()):(i=r.id,s.append("<input type='hidden' class='stripe_token' name='stripe_token' value='"+i+"'/>"),s.submit())}Stripe.setPublishableKey(wc_stripe_params.key),jQuery(function(){jQuery("form.checkout").on("checkout_place_order_wpem_stripe",function(e){return stripeFormHandler()}),jQuery("form#order_review").submit(function(){return stripeFormHandler()}),jQuery("form.checkout, form#order_review").on("change","#wpem_stripe-card-number, #wpem_stripe-card-expiry, #wpem_stripe-card-cvc, input[name=stripe_card_id]",function(e){jQuery(".woocommerce_error, .woocommerce-error, .woocommerce-message, .woocommerce_message, .stripe_token").remove(),jQuery(".stripe_token").remove()}),jQuery("form.checkout, form#order_review").on("change","input[name=stripe_card_id]",function(){"new"==jQuery("input[name=stripe_card_id]:checked").val()?jQuery("#stripe_new_card").slideDown(200):jQuery("#stripe_new_card").slideUp(200)})});